"use strict";(()=>{var e={};e.id=134,e.ids=[134],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},53:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>f,patchFetch:()=>m,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>p,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>y});var s={};r.r(s),r.d(s,{POST:()=>l});var o=r(5419),a=r(9108),i=r(9678),n=r(8070);async function l(e){try{let{query:t,searchType:r,userDomain:s}=await e.json();if(!t)return n.Z.json({error:"Query is required"},{status:400});console.log(`
ðŸ” Analyzing competitor: ${t} (${r})`);let o=new URLSearchParams({active_status:"active",ad_type:"all",country:"ALL",q:t,media_type:"all"}),a=`https://www.facebook.com/ads/library/?${o.toString()}`;if(console.log(`ðŸ“š Ads Library URL: ${a}`),!(process.env.OXYLABS_USERNAME&&process.env.OXYLABS_PASSWORD))return console.warn("âš ï¸ Oxylabs not configured for competitor analysis"),n.Z.json({query:t,adCount:0,message:"Competitor analysis requires Oxylabs configuration",fallback:!0});try{console.log("\uD83D\uDD27 Using Oxylabs to scrape Facebook Ads Library...");let e=await fetch("https://realtime.oxylabs.io/v1/queries",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Basic "+Buffer.from(`${process.env.OXYLABS_USERNAME}:${process.env.OXYLABS_PASSWORD}`).toString("base64")},body:JSON.stringify({source:"universal",url:a,render:"html",javascript:!0,timeout:3e4,wait_for_selector:'[role="feed"]',parse:!0,parsing_instructions:{results_text:{_fns:[{_fn:"xpath",_args:["//div[contains(text(),'results') or contains(text(),'ads')]/text()"]}]},ad_count:{_fns:[{_fn:"xpath",_args:["count(//div[@role='article'])"]}]},ad_texts:{_fns:[{_fn:"css",_args:["[role='article'] span"]}]},advertisers:{_fns:[{_fn:"xpath",_args:["//a[contains(@href,'/ads/library/')]/text()"]}]}}}),signal:AbortSignal.timeout(35e3)});if(e.ok){let s=await e.json(),o=s.results?.[0]?.parsed||{},i=s.results?.[0]?.content||"",l="string"==typeof i?i:JSON.stringify(i);console.log("âœ… Oxylabs extraction successful"),console.log("\uD83D\uDCCA Content length:",l.length),console.log("\uD83D\uDCCA Parsed data:",{results_text:o.results_text,ad_count:o.ad_count,advertisers:o.advertisers?.slice(0,3)}),l.length>0&&console.log("\uD83D\uDCC4 Content snippet:",l.substring(0,200));let u=parseInt(o.ad_count)||0,c=String(l),d=u>0||c.includes("active ad")||c.includes("Active ads"),p=[];(c.includes("video")||c.includes("Video"))&&p.push("video"),(c.includes("carousel")||c.includes("Carousel"))&&p.push("carousel"),(c.includes("image")||c.includes("Image"))&&p.push("image"),c.includes("collection")&&p.push("collection");let g=function(e){let t=[],r="string"==typeof e?e:JSON.stringify(e);for(let[e,s]of Object.entries({"Sale/Discount":/sale|discount|off|save|promo|deal/gi,"Free Shipping":/free shipping|free delivery/gi,"Limited Time":/limited|hurry|ends|last chance|today only/gi,"New Arrival":/new|just arrived|latest|fresh/gi,"Best Seller":/best seller|popular|trending|top rated/gi,Guarantee:/guarantee|warranty|money back|risk free/gi,"Social Proof":/reviews|customers|trusted by|loved by/gi,"Call to Action":/shop now|buy now|get started|learn more|sign up/gi}))s.test(r)&&t.push(e);return t.slice(0,5)}(o.ad_texts||l),y="";return y=0===u?"No active Facebook ads found. Great opportunity to be first!":u<5?"Light advertising presence. Room to dominate with aggressive campaigns.":u<20?"Moderate advertising activity. Focus on unique value props to stand out.":"Heavy advertiser! Study their strategy and find gaps to exploit.",n.Z.json({query:t,searchType:r,adCount:u||(d?"1+":0),hasActiveAds:d,adTypes:p.length>0?p:null,themes:g,advertisers:o.advertisers?.slice(0,5),insight:y,adsLibraryUrl:a})}{let t=await e.text();throw console.error("Oxylabs error:",e.status,t.substring(0,200)),Error(`Oxylabs request failed with status ${e.status}`)}}catch(e){return console.error("âš ï¸ Failed to analyze competitor:",e),n.Z.json({query:t,searchType:r,adCount:0,message:"Could not access Facebook Ads Library",adsLibraryUrl:a,fallback:!0,error:e instanceof Error?e.message:"Unknown error"})}}catch(e){return console.error("Competitor analysis error:",e),n.Z.json({error:"Could not analyze competitor",details:e.message},{status:500})}}let u=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/analyze-competitor/route",pathname:"/api/analyze-competitor",filename:"route",bundlePath:"app/api/analyze-competitor/route"},resolvedPagePath:"/Users/marktaylor/Desktop/First-Aid-For-Ads/app/api/analyze-competitor/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:d,serverHooks:p,headerHooks:g,staticGenerationBailout:y}=u,f="/api/analyze-competitor/route";function m(){return(0,i.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:d})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,206],()=>r(53));module.exports=s})();