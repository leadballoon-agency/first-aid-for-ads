"use strict";(()=>{var e={};e.id=438,e.ids=[438],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1017:e=>{e.exports=require("path")},1133:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>F,originalPathname:()=>P,patchFetch:()=>C,requestAsyncStorage:()=>b,routeModule:()=>S,serverHooks:()=>x,staticGenerationAsyncStorage:()=>j,staticGenerationBailout:()=>O});var n={};r.r(n),r.d(n,{GET:()=>_,POST:()=>v});var a=r(5419),o=r(9108),i=r(9678),s=r(8070);let c=require("fs/promises");var u=r.n(c),l=r(1017),d=r.n(l);let p=d().join(process.cwd(),"data","conversations.json"),g=d().join(process.cwd(),"data","patterns.json");async function f(){let e=d().join(process.cwd(),"data");try{await u().access(e)}catch{await u().mkdir(e,{recursive:!0})}}async function h(){try{let e=await u().readFile(p,"utf-8");return JSON.parse(e)}catch{return[]}}async function m(e){await f(),await u().writeFile(p,JSON.stringify(e,null,2))}async function y(){try{let e=await u().readFile(g,"utf-8");return JSON.parse(e)}catch{return{successful:[],failed:[],insights:[]}}}async function w(e){await f(),await u().writeFile(g,JSON.stringify(e,null,2))}async function v(e){try{let t=await e.json(),r={...t,id:`conv_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString()},n=await h(),a=await y(),o=function(e){let t=[];return!e.pixelFound&&e.bookedCall&&t.push({type:"success_pattern",category:"no_pixel_to_booking",trigger:"No pixel detected + spending money",outcome:"Booked technical call",confidence:.9}),"10_50"===e.conversionsPerWeek&&"kerry_trial"===e.callType&&t.push({type:"success_pattern",category:"learning_limited_to_trial",trigger:"Learning limited (10-50 conversions)",outcome:"Signed up for Kerry trial",confidence:.85}),e.messageCount<=1&&!e.bookedCall&&t.push({type:"failure_pattern",category:"quick_abandonment",trigger:"User left after first message",improvement:"Opening message may be too aggressive",confidence:.7}),t}(t);o.forEach(e=>{"success_pattern"===e.type?a.successful.push({...e,conversationId:r.id,timestamp:new Date().toISOString()}):"failure_pattern"===e.type&&a.failed.push({...e,conversationId:r.id,timestamp:new Date().toISOString()})});let i=n.length+1,c=n.filter(e=>e.bookedCall).length+(t.bookedCall?1:0),u=(c/i*100).toFixed(1);return n.push(r),await m(n),await w(a),s.Z.json({success:!0,conversationId:r.id,insights:o,metrics:{totalConversations:i,bookings:c,bookingRate:`${u}%`,topPatterns:k(a)}})}catch(e){return console.error("Conversation tracking error:",e),s.Z.json({success:!1,error:"Failed to track conversation"},{status:500})}}function k(e){let t={};return e.successful.forEach(e=>{t[e.category]||(t[e.category]={count:0,confidence:0}),t[e.category].count++,t[e.category].confidence=Math.max(t[e.category].confidence,e.confidence)}),Object.entries(t).map(([e,t])=>({category:e,occurrences:t.count,confidence:t.confidence})).sort((e,t)=>t.occurrences-e.occurrences).slice(0,5)}async function _(){try{let e=await h(),t=await y(),r=e.length,n=e.filter(e=>e.bookedCall).length,a={hot:e.filter(e=>"hot"===e.segment).length,warm:e.filter(e=>"warm"===e.segment).length,cold:e.filter(e=>"cold"===e.segment).length};return s.Z.json({metrics:{totalConversations:r,bookings:n,bookingRate:r>0?`${(n/r*100).toFixed(1)}%`:"0%",bySegment:a},topPatterns:k(t),recentInsights:t.insights?.slice(-10)||[]})}catch(e){return console.error("Error fetching conversation insights:",e),s.Z.json({error:"Failed to fetch insights"},{status:500})}}let S=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/track-conversation/route",pathname:"/api/track-conversation",filename:"route",bundlePath:"app/api/track-conversation/route"},resolvedPagePath:"/Users/marktaylor/Desktop/First-Aid-For-Ads/app/api/track-conversation/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:b,staticGenerationAsyncStorage:j,serverHooks:x,headerHooks:F,staticGenerationBailout:O}=S,P="/api/track-conversation/route";function C(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:j})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[638,206],()=>r(1133));module.exports=n})();